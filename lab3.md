# Лабораторная работа №3: Расширенные права доступа и аудит

## Цель лабораторной работы
Изучить механизмы расширенного разграничения прав доступа в Astra Linux и освоить настройку системы аудита безопасности для контроля действий пользователей и процессов.

## Задачи лабораторной работы
1. Изучить работу с расширенными атрибутами файлов с помощью команд **lsattr** и **chattr**.  
2. Освоить управление списками контроля доступа (**Access Control Lists, ACL**) с помощью утилит **setfacl** и **getfacl**.  
3. Настроить планировщик заданий **cron** с учетом мандатных меток безопасности.  
4. Настроить систему аудита безопасности с использованием **auditd**:  
   - создать правило для аудита доступа к определенному файлу;  
   - включить аудит попыток неуспешного входа в систему;  
   - проанализировать логи аудита с помощью **ausearch** и **aureport**.  

## Ожидаемый результат
Получение практических навыков:
- управления расширенными правами доступа, настройками ACL, 
- планирования задач с учетом политик безопасности и анализа аудита в Astra Linux. 

Освоение команд для проверки и изменения атрибутов, а также методы контроля действий пользователей и процессов.

---

## Теоретическая часть

### 1. Расширенные атрибуты файлов (lsattr, chattr)
В Astra Linux файлы могут иметь дополнительные атрибуты, влияющие на поведение файловой системы ext4.

**Основные атрибуты:**

| Атрибут | Описание |
|----------|-----------|
| **i** | Файл неизменяем. Его нельзя удалить, переименовать или изменить содержимое. |
| **a** | Разрешено только добавление данных (append-only). |
| **e** | Файл использует extents (по умолчанию в ext4). |
| **A** | Не обновлять время последнего доступа (atime). |

**Просмотр атрибутов:**
```bash
lsattr /путь/к/файлу
```

**Изменение атрибутов:**
```bash
sudo chattr +i important.txt
sudo chattr -i important.txt
```

---

### 2. Access Control Lists (ACL)
ACL — механизм тонкой настройки прав доступа, позволяющий назначать права отдельным пользователям и группам помимо стандартных владельца/группы/остальных.
Для просмотра списков доступа предназначена утилита getfacl (Get File ACL), для редактирования этих списков предназначена утилита setfacl (Set File ACL).

**Просмотр текущих ACL:**
```bash
getfacl file.txt
```

**Добавление прав пользователю:**
```bash
setfacl -m u:student:rwx file.txt
```

**Удаление ACL-записи:**
```bash
setfacl -x u:student file.txt
```

**Сброс всех ACL:**
```bash
setfacl -b file.txt
```

Для корректной работы ACL необходимо, чтобы файловая система была смонтирована с опцией `acl`. Проверка:
```bash
mount | grep acl
```

---

### 3. Планировщик заданий cron и мандатные метки
Cron позволяет автоматизировать выполнение команд по расписанию. В Astra Linux с мандатным контролем целостности и доступа важно учитывать уровень безопасности (метку), на котором создается задание.

**Основные файлы:**
- `/etc/crontab` — системные задания;
- `/var/spool/cron/` — индивидуальные задания пользователей.

**Добавление задания:**
```bash
crontab -e
```

**Пример:**
```bash
*/5 * * * * /usr/bin/logger "Проверка активности пользователей"
```

При включенном мандатном контроле cron запускает задачи с уровнем метки пользователя, установившего задание. Проверить текущую метку:
```bash
id -Z
```

---

### 4. Настройка и использование auditd
Auditd — сервис аудита, фиксирующий действия пользователей и системных процессов.

**Проверка статуса службы:**
```bash
sudo systemctl status auditd
```

**Запуск и включение:**
```bash
sudo systemctl enable --now auditd
```

#### 4.1. Аудит доступа к файлу
Добавьте правило аудита:
```bash
sudo auditctl -w /etc/passwd -p rwxa -k passwd_watch
```
- `-w` — наблюдать за файлом  
- `-p rwxa` — контролировать чтение, запись, исполнение, изменение атрибутов  
- `-k` — метка (ключ) для фильтрации записей  

Проверка записей по ключу:
```bash
sudo ausearch -k passwd_watch
```

#### 4.2. Аудит неудачных попыток входа
Проверка событий неудачных логинов:
```bash
sudo ausearch -m USER_LOGIN --success no
```

Или через отчет:
```bash
sudo aureport -au
```

#### 4.3. Просмотр последних событий аудита
```bash
sudo ausearch -ts today
```

#### 4.4. Сохранение правил аудита
Чтобы правила сохранялись после перезагрузки:
1. Добавьте их в `/etc/audit/rules.d/audit.rules`
2. Перезапустите службу:
```bash
sudo systemctl restart auditd
```

---

## Практическое задание

1. **Работа с расширенными атрибутами:**
   - Создайте файл `test.txt`.
   - Установите атрибут неизменяемости (`chattr +i`).
   - Попробуйте удалить или изменить файл (должно быть запрещено).
   - Снимите атрибут (`chattr -i`).

2. **Настройка ACL:**
   - Создайте двух пользователей: `user1` и `user2`.
   - Создайте файл `acltest.txt` от имени `user1`.
   - Добавьте `user2` права чтения и записи с помощью `setfacl`.
   - Проверьте результат через `getfacl`.

3. **Настройка cron:**
   - Настройте cron-задачу, которая каждые 2 минуты записывает дату в файл `/home/user1/time.log`.
   - Проверьте, что задача выполняется.
   - Определите уровень мандатной метки cron-задачи.

4. **Настройка аудита:**
   - Включите службу `auditd`.
   - Добавьте правило для слежения за изменениями в `/etc/passwd`.
   - Измените файл (например, добавив пользователя).
   - Проверьте запись в логе аудита (`ausearch -k passwd_watch`).
   - Найдите события неудачных входов в систему.

5. **Отчет:**
   - В отчете приведите все использованные команды.
   - Добавьте скриншоты вывода команд `lsattr`, `getfacl`, `crontab -l`, `ausearch`.
   - Опишите, какие права и действия фиксируются системой аудита.

---

## Контрольные вопросы
1. Чем отличаются стандартные UNIX-права от ACL?  
2. Какие атрибуты можно установить с помощью `chattr`?  
3. Для чего используется планировщик заданий `cron`?  
4. Какой командой можно проверить неудачные попытки входа?  
5. Как сделать так, чтобы правила аудита сохранялись после перезагрузки?

---

## Дополнительная литература
- Документация Astra Linux: [https://wiki.astralinux.ru/](https://wiki.astralinux.ru/)
- Руководство по ACL: [https://wiki.archlinux.org/title/Access_Control_Lists_(Русский)](https://wiki.archlinux.org/title/Access_Control_Lists_(Русский))
Today 11-10-2025 you use ruffle!
